<?xml version="1.0" encoding="UTF-8" ?>

<odoo>
    <template id="report_invoice_with_payments" inherit_id="account.report_invoice_document">
        <xpath expr="//div[hasclass('row')]//div[@name='address_not_same_as_shipping']//t[@t-set='address']" position="inside">
            <t t-set="information_block_pos">
                <div t-if="o.pos_order_ids">
                    <address t-field="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice"
                             t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                    <div t-if="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice.vat" class="mt16">
                        <span t-field="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice.vat"/>
                    </div>
                </div>
            </t>
        </xpath>

        <xpath expr="//div[hasclass('row')]//div[@name='address_same_as_shipping']//t[@t-set='address']" position="inside">
            <t t-set="information_block_pos">
                <div t-if="o.pos_order_ids">
                    <address t-field="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice"
                             t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                    <div t-if="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice.vat" class="mt16">
                        <span t-field="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice.vat"/>
                    </div>
                </div>
            </t>
        </xpath>

        <xpath expr="//div[hasclass('row')]//div[@name='no_shipping']//t[@t-set='address']" position="after">
            <t t-set="information_block_pos">
                <div t-if="o.pos_order_ids">
                    <address t-field="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice"
                             t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                    <div t-if="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice.vat" class="mt16">
                        <span t-field="o.pos_order_ids.session_id.config_id.approval_partner_for_invoice.vat"/>
                    </div>
                </div>
            </t>
        </xpath>

        <xpath expr="//div[hasclass('clearfix')]"
               position="before">
            <div>
                <t t-if="o.move_type in ['out_invoice','in_invoice']">
                    <b style="margin-left:15px;font-size:20px">Total Articulos :</b>
                    <t t-set="total_articles_count_for_receipt" t-value="0"/>
                    <t t-foreach="lines" t-as="line">
                        <t t-if="line.product_id.detailed_type in ['consu','product'] and line.product_id.sale_ok"
                           t-set="total_articles_count_for_receipt"
                           t-value="total_articles_count_for_receipt+(line.quantity)"/>
                    </t>
                    <b>
                        <span style="margin-left:15px;font-weight:bold;font-size:20px"
                              t-out="total_articles_count_for_receipt"/>
                    </b>
                </t>
            </div>
        </xpath>

    </template>
</odoo>