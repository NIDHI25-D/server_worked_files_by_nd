<?xml version="1.0"?>
<odoo>
    <data>
        <record id="vendor_charge_status_action" model="ir.actions.act_window">
            <field name="name">Vendor charge status</field>
            <field name="res_model">vendor.charge.status</field>
            <field name="view_mode">list,form</field>
        </record>

        <!--        settings action -->

        <record id="crm_claim_settings_action" model="ir.actions.act_window">
            <field name="name">Settings</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.config.settings</field>
            <field name="view_mode">form</field>
            <field name="view_id"
                   ref="res_config_settings_view_form_inherit_setu_claims_from_website"/>
            <field name="target">inline</field>
            <field name="context">{'module' : 'setu_claims_from_website'}</field>
        </record>


        <!-- Claims categories  -->

        <record id="crm_claim_categ_action" model="ir.actions.act_window">
            <field name="name">Claim Categories</field>
            <field name="res_model">crm.case.categ</field>


            <field name="domain">[('object_id.model', '=', 'crm.claim')]</field>
            <field name="context" eval="{'object_id': ref('model_crm_claim')}"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to create a claim category.
                </p>
                <p>
                    Create claim categories to better manage and classify your
                    claims. Some example of claims can be: preventive action,
                    corrective action.
                </p>
            </field>
        </record>


        <!-- Claim Stages -->

        <record id="crm_claim_stage_tree" model="ir.ui.view">
            <field name="name">crm.claim.stage.tree</field>
            <field name="model">crm.claim.stage</field>
            <field name="arch" type="xml">
                <list string="Claim Stages">
                    <field name="sequence"/>
                    <field name="name"/>
                </list>
            </field>
        </record>

        <record id="crm_claim_stage_form" model="ir.ui.view">
            <field name="name">crm.claim.stage.form</field>
            <field name="model">crm.claim.stage</field>
            <field name="arch" type="xml">
                <form string="Claim Stage" duplicate="false">
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="case_default"/>
                            <field name="sequence"/>
                            <field name="next_stage_id" domain="[('id', '!=', context.get('active_id'))]"/>
                            <field name="is_last_stage"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="crm_claim_stage_act" model="ir.actions.act_window">
            <field name="name">Claim Stages</field>
            <field name="res_model">crm.claim.stage</field>
            <field name="view_id" ref="crm_claim_stage_tree"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to setup a new stage in the processing of the claims.
                </p>
                <p>
                    You can create claim stages to categorize the status of every
                    claim entered in the system. The stages define all the steps
                    required for the resolution of a claim.
                </p>
            </field>
        </record>

        <!-- action type  -->

        <record id="action_for_action_type" model="ir.actions.act_window">
            <field name="name">Action Type</field>
            <field name="res_model">crm.action.type</field>
            <field name="view_mode">list</field>
        </record>

        <record id="crm_action_type_tree_view" model="ir.ui.view">
            <field name="name">crm.action.type.tree.view</field>
            <field name="model">crm.action.type</field>
            <field name="arch" type="xml">
                <list string="Action Type" editable="top">
                    <field name="name"/>
                    <field name="crm_case_categ_id" options="{'no_create': True, 'no_create_edit':True}"/>
                </list>
            </field>
        </record>


        <!-- Claims    -->


        <record id="crm_case_claims_tree_view" model="ir.ui.view">
            <field name="name">Claims Tree</field>
            <field name="model">crm.claim</field>
            <field name="arch" type="xml">
                <list>
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="product_tmpl_id"/>
                    <field name="user_id"/>
                    <field name="date"/>
                    <field name="stage_id"/>
                    <field name="date_action_next"/>
                    <field name="action_next"/>
                    <field name="categ_id" string="Type"/>
                    <field name="date_deadline" invisible="1"/>
                    <field name="date_closed" invisible="1"/>
                </list>
            </field>
        </record>


        <record model="ir.ui.view" id="crm_case_claims_form_view">
            <field name="name">CRM - Claims Form</field>
            <field name="model">crm.claim</field>

            <field name="arch" type="xml">
                <form string="Claim">
                    <header>
                        <field name="stage_id" widget="statusbar" options="{'clickable': '1'}" readonly="1"/>
                    </header>
                    <sheet string="Claims">
                        <group name="name_date">
                            <group>
                                <field name="name"/>
                                <field name="date"/>
                            </group>
                            <group>
                                <field name="user_id"
                                       context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'sales_team.group_sale_salesman_all_leads']}"/>
                            </group>
                        </group>

                        <group colspan="4" col="4" groups="base.group_user">
                            <field name="priority" widget="priority"/>
                            <field name="team_id"/>
                            <field name="date_deadline"/>
                        </group>
                        <notebook>
                            <page string="Claim Description">
                                <group colspan="4" col="2" groups="base.group_user">
                                    <separator colspan="2" string="Claim Exceptions"/>
                                    <field name="irrigation_system"/>
                                    <field name="potential_trouble"/>
                                    <field name="ctb_repair"/>
                                    <field name="no_warranty_apply"/>
                                </group>

                                <group colspan="4" col="2" groups="base.group_user">
                                    <separator colspan="2" string="Claim Reporter"/>
                                    <field name="partner_id" string="Partner"
                                           options="{'no_create': True, 'no_create_edit':True}"/>
                                    <field name="contact_information"/>
                                    <field name="partner_phone"/>
                                    <field name="email_from" widget="email"/>
                                    <field name="product_tmpl_id" options="{'no_create': True, 'no_create_edit':True}"/>
                                    <field name="product_default_code" invisible="1"/>
                                    <field name="product_default_name" invisible="1"/>
                                    <field name="is_from_website" readonly="1"/>
                                    <field name="warranty_ids" widget="many2many_tags" readonly="1"/>
                                </group>
                                <group colspan="2" col="2" groups="base.group_user">
                                    <separator colspan="2" string="Responsibilities"/>
                                    <field name="user_fault" required="1"/>
                                    <field name="categ_id" options="{'no_create': True, 'no_create_edit':True}"
                                           domain="[('object_id.model', '=', 'crm.claim')]"/>
                                    <field name="ref"/>
                                </group>
                                <separator colspan="4" string="Claim/Action Description" groups="base.group_user"/>
                                <field name="description" colspan="4" nolabel="1"/>
                            </page>
                            <page id='follow_up' string="Follow Up" groups="base.group_user">
                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Actions"/>
                                    <field name="date_action_next"/>
                                    <field name="action_next"/>
                                    <field name="shipping_carrier_id"/>
                                    <field name="x_studio_fecha_de_envio"/>
                                    <field name="carrier_tracking_ref"/>
                                </group>
                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Dates"/>
                                    <field name="create_date" groups="base.group_no_one"/>
                                    <field name="date_closed"/>
                                    <!--field name="date_closed" invisible="1"/-->
                                    <field name="write_date" groups="base.group_no_one"/>
                                </group>

                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Root Causes"/>
                                    <field name="cause" colspan="2" nolabel="1"/>
                                </group>
                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Resolution Actions"/>
                                    <field name="action_type_id" options="{'no_create': True, 'no_create_edit':True}"
                                           required="1"/>
                                    <field name="resolution" colspan="2" nolabel="1"
                                           placeholder="Action Description..."/>
                                    <field name="rejected"/>
                                    <field name="rejection_reason" invisible="rejected == False"
                                           required="rejected !=  False"/>
                                </group>
                            </page>
                            <page string="Other Information">
                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Expenses"/>
                                    <field name="is_expense"/>
                                    <field name="parent_id" options="{'no_create': True, 'no_create_edit':True}"/>
                                    <field name="cost_without_vat" widget='monetary'
                                           options="{'currency_field': 'currency_id'}" readonly="False"/>
                                </group>
                                <group>
                                    <field name="invoice_ids" domain="[('partner_id', '!=', False),('state', '=', 'posted'),
                                                                        ('payment_state','in',['in_payment','paid','partial']),
                                                                        ('move_type', '=', 'out_invoice')]">
                                        <list create="0">
                                            <field name="name"/>
                                            <field name="l10n_mx_edi_cfdi_uuid"/>
                                            <field name="date" optional="show"/>
                                            <field name="invoice_date_due" optional="show"/>
                                            <field name="invoice_origin" optional="show"/>
                                            <field name="payment_reference" optional="show"/>
                                            <field name="ref" optional="show"/>
                                            <field name="activity_ids" optional="show"/>
                                            <field name="company_id" optional="show"/>
                                            <field name="amount_untaxed_signed" optional="show"/>
                                            <field name="amount_tax_signed" optional="show"/>
                                            <field name="amount_total_signed" optional="show"/>
                                            <field name="amount_total_in_currency_signed" optional="show"/>
                                            <field name="amount_residual_signed" optional="show"/>
                                            <field name="currency_id" optional="show"/>
                                            <!--it's removed from the base-->
                                            <!--<field name="to_check" optional="show"/>-->
                                            <field name="payment_state" optional="show"/>
                                            <field name="state" optional="show"/>
                                        </list>
                                    </field>

                                </group>
                            </page>
                            <page string="Vendor Charges">
                                <group>
                                    <group>
                                        <field name="claim_sent"/>
                                        <field name="claim_date_sent_to_vendor"/>
                                        <field name="claim_comments"/>
                                        <field name="recovered_balance_in_usd"/>
                                        <field name="payed_claim_finished"/>
                                        <field name="vendor_rejection_motive"/>
                                    </group>
                                    <group>
                                        <field name="vendor_charges_status" options="{'no_create': True}"/>
                                        <field name="related_po" options="{'no_create': True}"/>
                                        <field name="internal_claim_reference"/>
                                    </group>
                                </group>
                            </page>
                            <page string="History">
                                <field name="claim_history_ids">
                                    <list editable="bottom" create="false" delete="false">
                                        <field name="stage_id" readonly="1"/>
                                        <field name="create_uid" string="User" readonly="1"/>
                                        <field name="create_date" string="Date" readonly="1"/>
                                    </list>
                                </field>
                            </page>


                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="crm_case_claims_kanban_view">
            <field name="name">Crm Claim kanban</field>
            <field name="model">crm.claim</field>
            <field name="priority" eval="3"/>
            <field name="type">kanban</field>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id" class="o_kanban_small_column o_opportunity_kanban"
                        on_create="quick_create" default_mode="kanban"
                        quick_create_view="setu_claims_from_website.crm_case_claims_form_view">
                    <field name="stage_id"/>
                    <field name="name"/>
                    <field name="product_tmpl_id"/>
                    <field name="product_default_code"/>
                    <field name="product_default_name"/>
                    <field name="partner_id"/>
                    <field name="activity_state"/>
                    <progressbar field="activity_state"
                                 colors='{"planned": "success", "today": "warning", "overdue": "danger"}'/>
                    <templates>
                        <t t-name="card">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <b class="o_kanban_record_title mt8">
                                                <strong>
                                                    <field name="name"/>
                                                </strong>
                                                <br/>
                                            </b>
                                            <br/>
                                            <div class="oe_kanban_content flex-grow-1" t-if="record.partner_id.value">
                                                <span>Customer:</span>
                                                <br/>
                                                <field name="partner_id"/>
                                            </div>
                                            <br/>
                                            <div class="oe_kanban_content flex-grow-1"
                                                 t-if="record.product_tmpl_id.value">
                                                <span>Product:</span>
                                                <br/>
                                                <strong>
                                                    [<field name="product_default_code" style="min-width: 590px;"/>]
                                                </strong>
                                                <field name="product_default_name"/>
                                            </div>
                                            <br/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Claim Calendar view -->

        <record model="ir.ui.view" id="crm_case_claims_calendar_view">
            <field name="name">Claims Actions</field>
            <field name="model">crm.claim</field>
            <field name="priority" eval="2"/>
            <field name="arch" type="xml">
                <calendar string="Claims" date_start="date_action_next" color="user_id">
                    <field name="name"/>
                </calendar>
            </field>
        </record>


        <!-- Crm claim Search view -->

        <record id="view_crm_case_claims_filter" model="ir.ui.view">
            <field name="name">CRM - Claims Search</field>
            <field name="model">crm.claim</field>
            <field name="arch" type="xml">
                <search string="Search Claims">
                    <field name="name" string="Claims"/>
                    <filter string="Unassigned Claims" name="unassigned" domain="[('user_id','=', False)]"
                            help="Unassigned Claims"/>
                    <field name="partner_id" filter_domain="[('partner_id','child_of',self)]"/>
                    <field name="user_id"/>

                    <filter string="Partner" name="partner" domain="[]" help="Partner"
                            context="{'group_by':'partner_id'}"/>
                    <filter string="Responsible" name="responsible" domain="[]" help="Responsible User"
                            context="{'group_by':'user_id'}"/>
                    <filter string="Stage" name="stage" domain="[]" context="{'group_by':'stage_id'}"/>
                    <filter string="Type" name="type" domain="[]" context="{'group_by':'categ_id'}"/>
                    <filter string="Claim Month" name="month" domain="[]" help="Claim Date by Month"
                            context="{'group_by':'date'}"/>
                    <filter string="Deadline" name="deadline" domain="[]" context="{'group_by':'date_deadline'}"/>
                    <filter string="Closure" name="closure" domain="[]" help="Date Closed"
                            context="{'group_by':'date_closed'}" groups="base.group_no_one" invisible="1"/>

                </search>
            </field>
        </record>

    </data>
</odoo>